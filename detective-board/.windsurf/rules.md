# Правила проекта (Windsurf Rules)

Этот файл описывает обязательные правила и рабочий процесс для проекта `detective-board`. Windsurf и участники команды должны руководствоваться этими правилами.

## Коммуникация и поведение
- Всегда отвечать на русском языке, кратко и по делу.
- Минимум уточнений — максимум самостоятельности. Стараться доводить задачи до конца без отвлечения пользователя.
- Перед тем как звать пользователя: убедиться, что все проверки прошли и в браузерной консоли нет ошибок.

## Запуск и скрипты
- Dev-сервер: `npm run dev` (Vite, порт 5173 по умолчанию).
- Линтинг: `npm run lint` — должен быть без ошибок (warning допустимы только временно, но стремимся к 0).
- E2E-тесты: 
  - Установка браузеров: `npm run pw:install` (однократно на машине).
  - Запуск: `npm run test:e2e` (поднимает dev-сервер автоматически).

## Обязательный рабочий цикл перед завершением задачи
1) Запустить линтер: `npm run lint` — исправить все ошибки.
2) Запустить E2E: `npm run test:e2e` — тесты должны проходить.
3) Убедиться, что при ручном открытии приложения нет ошибок в консоли браузера. 
4) Логи в консоли должны быть предсказуемыми и информативными (см. раздел «Логирование»).

## Логирование
- Использовать только `src/logger.ts`. Никаких прямых `console.log/info/warn/error` в приложении, кроме ошибок внутри ErrorBoundary/инфраструктуры.
- Логи должны содержать scope (автоматически добавляется) и полезный контекст: идентификаторы сущностей, координаты, размеры и т.п.
- Уровень логирования можно менять через `localStorage.setItem('LOG_LEVEL', 'debug'|'info'|'warn'|'error')`.
- Ключевые места логируются: экшены стора, взаимодействия на канвасе, маршруты, запуск приложения.

## Подсказки (UX)
- Все интерактивные элементы (кнопки/ссылки) обязаны иметь `title` и `aria-label` с понятным описанием действия.

## Типизация и стиль кода
- TypeScript: без `any`. Использовать явные типы и полезные алиасы.
- Следовать правилам ESLint, не отключать `react-hooks/exhaustive-deps` без причины — корректно указывать зависимости хуков.
- Импорты — только в верхней части файла.
- Код форматируется как в репозитории (следуем конфигам по умолчанию проекта).

## Обработка ошибок
- UI: `ErrorBoundary` уже установлен и логирует ошибки. Не глушить исключения молча.
- Рантайм-ошибки отображаются оверлеем `src/errorOverlay.ts`. При добавлении нового кода не ломать его работу.

## Тестирование (Playwright)
- Тесты находятся в `tests/`.
- Базовый тест обязан проверять, что в консоли браузера нет ошибок.
- При добавлении новых возможностей дополнять сценарии E2E.

## Данные и хранилище
- Персистентность через IndexedDB/Dexie (`src/db.ts`). При ошибке IndexedDB допустим fallback в память — приложение не должно падать.

## Производительность и взаимодействия
- Операции на канвасе (pan/zoom/drag) должны быть плавными и не блокировать UI.
- Изменения размера/позиции нод — с ограничениями и валидацией величин.

## PR/коммиты (рекомендации)
- Сообщение коммита: кратко «что/почему», например: `feat(canvas): add pinch-zoom logging`.
- В PR-описании: цель, изменения, скрины/гифки по UI (если уместно), статус тестов.

## Безопасность и зависимости
- Не добавлять пакеты без необходимости. Любую установку зависимостей проводить осознанно.
- Не хранить секреты в коде. Конфигурации через переменные окружения/локальные настройки (если появятся).

## Готовность к демонстрации
- После любого изменения, влияющего на поведение, прогонять линт и e2e.
- Никаких ошибок в консоли браузера. Логи — чистые и понятные.

---
Эти правила могут дополняться по мере развития проекта. Вносите правки в этот файл в рамках PR с соответствующими объяснениями.
