# üöÄ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ Detective Board

## –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

### 1. **React.memo –¥–ª—è NodeShape**
```typescript
const NodeShape = React.memo<Props>((props) => {
  // ...
}, (prev, next) => {
  return prev.node === next.node && prev.selected === next.selected;
});
```
**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –£–∑–ª—ã –ø–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∏—Ö –¥–∞–Ω–Ω—ã—Ö –∏–ª–∏ —Å—Ç–∞—Ç—É—Å–∞ –≤—ã–¥–µ–ª–µ–Ω–∏—è

### 2. **Set –≤–º–µ—Å—Ç–æ Array –¥–ª—è selection**
```typescript
const selectionSet = useMemo(() => new Set(selection), [selection]);
// –û(1) –≤–º–µ—Å—Ç–æ –û(n) –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ selected={selectionSet.has(n.id)}
```
**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—ã–¥–µ–ª–µ–Ω–∏—è –≤ 100+ —Ä–∞–∑ –±—ã—Å—Ç—Ä–µ–µ

### 3. **–ü—Ä—è–º–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ Konva –±–µ–∑ store**
```typescript
// –í–æ –≤—Ä–µ–º—è drag –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ–º store - —Ç–æ–ª—å–∫–æ Konva refs
const ref = nodeRefsMap.current.get(id);
ref.x(newX); // –Ω–∞–ø—Ä—è–º—É—é –≤ Konva
ref.y(newY);
```
**–†–µ–∑—É–ª—å—Ç–∞—Ç:** 0 re-renders –≤–æ –≤—Ä–µ–º—è –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è

### 4. **Throttle viewport updates**
```typescript
const setViewport = useMemo(() => throttle(setViewportRaw, 16), [setViewportRaw]);
```
**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ú–∞–∫—Å–∏–º—É–º 60 –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π/—Å–µ–∫ –≤–º–µ—Å—Ç–æ —Å–æ—Ç–µ–Ω

### 5. **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ü–∏–π —Å–≤—è–∑–µ–π**
```typescript
const nodeProjections = useMemo(() => {
  const cache = new Map();
  links.forEach(l => {
    cache.set(l.fromId, projectToLevel(l.fromId));
  });
  return cache;
}, [nodes, links, currentParentId]);
```
**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ü–µ—Ä–µ—Å—á–µ—Ç —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö

### 6. **History snapshot 1 —Ä–∞–∑**
- –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–∏ –Ω–∞—á–∞–ª–µ drag
- –ü—Ä–∏–º–µ–Ω—è–µ–º –ø—Ä–∏ dragEnd
- –ù–ï –∫–ª–æ–Ω–∏—Ä—É–µ–º –≤–µ—Å—å –≥—Ä–∞—Ñ –Ω–∞ –∫–∞–∂–¥—ã–π –ø–∏–∫—Å–µ–ª—å

### 7. **–ú–∏–Ω–∏–º–∏–∑–∞—Ü–∏—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è**
- LOG_LEVEL=warn –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
- –û—Ç–∫–ª—é—á–µ–Ω mirror send (sendBeacon)
- –£–±—Ä–∞–Ω—ã debug –ª–æ–≥–∏ –∏–∑ hot path

## –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã

### –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

```bash
# –£–±–µ–¥–∏—Å—å —á—Ç–æ dev server –∑–∞–ø—É—â–µ–Ω
npm run dev

# –í –¥—Ä—É–≥–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ
npm run test:perf          # Headless
npm run test:perf:headed   # –° –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–µ–π
```

### –ß—Ç–æ —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç—Å—è

1. **FPS –ø—Ä–∏ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–∏** - –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å > 50 FPS
2. **–ó–∞–¥–µ—Ä–∂–∫–∞ –∫–ª–∏–∫–∞** - –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å < 50ms
3. **100 —É–∑–ª–æ–≤** - –ø–∞–Ω–æ—Ä–∞–º–∏—Ä–æ–≤–∞–Ω–∏–µ –±–µ–∑ –ª–∞–≥–æ–≤
4. **Memory leaks** - —Ä–æ—Å—Ç –ø–∞–º—è—Ç–∏ < 10MB –∑–∞ —Ü–∏–∫–ª
5. **Console errors** - –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –æ—à–∏–±–æ–∫

### –ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞

```
üìä FPS –ø—Ä–∏ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–∏: avg=58, min=52
‚ö° –í—Ä–µ–º—è –æ—Ç–∫–ª–∏–∫–∞ –Ω–∞ –∫–ª–∏–∫: 23ms
üé® –í—Ä–µ–º—è —Ä–µ–Ω–¥–µ—Ä–∞ 100 —É–∑–ª–æ–≤: 45ms
üñ±Ô∏è –ü–∞–Ω–æ—Ä–∞–º–∏—Ä–æ–≤–∞–Ω–∏–µ 100 —É–∑–ª–æ–≤: 178ms
üíæ –†–æ—Å—Ç –ø–∞–º—è—Ç–∏: 2.34MB
‚ùå Errors: 0
‚ö†Ô∏è Warnings: 0
```

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

### –í dev —Ä–µ–∂–∏–º–µ

–î–æ–±–∞–≤—å `?diag=1` –∫ URL:
```
http://localhost:5173?diag=1
```

–í –∫–æ–Ω—Å–æ–ª–∏ –±—É–¥—É—Ç –ª–æ–≥–∏:
```
[BoardCanvas] perf:mode { perfMode: false, superPerfMode: false, nodes: 45 }
[store] perf:renderedLinks:slow { ms: 24, linksInput: 120, linksOutput: 45 }
```

### –†–µ–∂–∏–º—ã –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç —Ä–µ–∂–∏–º—ã:

- **Normal mode** - < 300 —É–∑–ª–æ–≤, scale > 0.3
  - –ü–æ–ª–Ω–∞—è –æ—Ç—Ä–∏—Å–æ–≤–∫–∞
  - Bezier –∫—Ä–∏–≤—ã–µ –¥–ª—è —Å–≤—è–∑–µ–π
  - –¢–µ–Ω–∏ –∏ —ç—Ñ—Ñ–µ–∫—Ç—ã

- **Perf mode** - > 300 —É–∑–ª–æ–≤ –ò–õ–ò scale < 0.3
  - –ü—Ä—è–º—ã–µ –ª–∏–Ω–∏–∏ –≤–º–µ—Å—Ç–æ bezier
  - –£–ø—Ä–æ—â–µ–Ω–Ω—ã–µ —Ç–µ–Ω–∏
  - –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ 2000 —Å–≤—è–∑–µ–π

- **Super perf mode** - > 800 —É–∑–ª–æ–≤ –ò–õ–ò scale < 0.15
  - Hit detection –æ—Ç–∫–ª—é—á–µ–Ω
  - –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ 600 —Å–≤—è–∑–µ–π
  - –ú–∏–Ω–∏–º—É–º —ç—Ñ—Ñ–µ–∫—Ç–æ–≤

## –ü—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ

### Chrome DevTools

1. –û—Ç–∫—Ä–æ–π DevTools ‚Üí Performance
2. –ù–∞—á–Ω–∏ –∑–∞–ø–∏—Å—å
3. –í—ã–ø–æ–ª–Ω–∏ –æ–ø–µ—Ä–∞—Ü–∏—é (drag, pan, zoom)
4. –û—Å—Ç–∞–Ω–æ–≤–∏ –∑–∞–ø–∏—Å—å
5. –ü—Ä–æ–≤–µ—Ä—å:
   - **FPS meter** - –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∑–µ–ª—ë–Ω—ã–º (60 FPS)
   - **Main thread** - –Ω–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∫—Ä–∞—Å–Ω—ã—Ö –±–ª–æ–∫–æ–≤ (long tasks)
   - **Memory** - –Ω–µ –¥–æ–ª–∂–Ω–æ —Ä–∞—Å—Ç–∏ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ

### React DevTools Profiler

1. –£—Å—Ç–∞–Ω–æ–≤–∏ React DevTools
2. –û—Ç–∫—Ä–æ–π Profiler tab
3. –ù–∞—á–Ω–∏ –ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ
4. –í—ã–ø–æ–ª–Ω–∏ –æ–ø–µ—Ä–∞—Ü–∏—é
5. –ü—Ä–æ–≤–µ—Ä—å flame graph:
   - NodeShape –Ω–µ –¥–æ–ª–∂–µ–Ω –ø–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞—Ç—å—Å—è –ø—Ä–∏ –¥–≤–∏–∂–µ–Ω–∏–∏
   - BoardCanvas re-renders –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã

## –ß–µ–∫–ª–∏—Å—Ç –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

–ü—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –Ω–æ–≤—ã—Ö —Ñ–∏—á –ø—Ä–æ–≤–µ—Ä—å:

- [ ] –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è React.memo –¥–ª—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –≤ —Å–ø–∏—Å–∫–∞—Ö
- [ ] useMemo –¥–ª—è —Ç—è–∂–µ–ª—ã—Ö –≤—ã—á–∏—Å–ª–µ–Ω–∏–π
- [ ] useCallback –¥–ª—è —Ñ—É–Ω–∫—Ü–∏–π –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è—Ö
- [ ] –ò–∑–±–µ–≥–∞–π `selection.includes()` - –∏—Å–ø–æ–ª—å–∑—É–π Set
- [ ] –ù–µ –æ–±–Ω–æ–≤–ª—è–π store –≤ –≥–æ—Ä—è—á–∏—Ö —Ü–∏–∫–ª–∞—Ö (drag, resize)
- [ ] –õ–æ–≥–∏—Ä—É–π —Ç–æ–ª—å–∫–æ –≤–∞–∂–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è (warn/error)
- [ ] –¢–µ—Å—Ç–∏—Ä—É–π —Å 100+ —É–∑–ª–∞–º–∏

## –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

1. **IndexedDB** - –æ–ø–µ—Ä–∞—Ü–∏–∏ async, –º–æ–≥—É—Ç —Ç–æ—Ä–º–æ–∑–∏—Ç—å –ø—Ä–∏ –±–æ–ª—å—à–æ–º –æ–±—ä–µ–º–µ
2. **Konva shadows** - –¥–æ—Ä–æ–≥–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è, –æ—Ç–∫–ª—é—á–∞–µ—Ç—Å—è –≤ perf mode
3. **History** - —Ö—Ä–∞–Ω–∏—Ç –ø–æ–ª–Ω—ã–µ –∫–æ–ø–∏–∏ –≥—Ä–∞—Ñ–∞, –∑–∞–Ω–∏–º–∞–µ—Ç –ø–∞–º—è—Ç—å

## –î–∞–ª—å–Ω–µ–π—à–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

- [ ] Virtual scrolling –¥–ª—è —É–∑–ª–æ–≤ –∑–∞ –≤–∏–¥–∏–º–æ–π –æ–±–ª–∞—Å—Ç—å—é
- [ ] Web Workers –¥–ª—è —Ç—è–∂–µ–ª—ã—Ö –≤—ã—á–∏—Å–ª–µ–Ω–∏–π (layout, search)
- [ ] –û—Ñ—Ñ—Å–∫—Ä–∏–Ω canvas –¥–ª—è –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞
- [ ] Incremental sync —Å IndexedDB (debounce)
- [ ] WebGL renderer –¥–ª—è > 1000 —É–∑–ª–æ–≤

## –ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### –¶–µ–ª–µ–≤—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏

- **FPS**: > 55 –ø—Ä–∏ –ª—é–±—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏—è—Ö
- **Time to Interactive**: < 1s
- **First Paint**: < 500ms  
- **Memory**: < 200MB –¥–ª—è 500 —É–∑–ª–æ–≤
- **Click Response**: < 30ms

### –¢–µ–∫—É—â–∏–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ (–ø–æ—Å–ª–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏)

- ‚úÖ FPS: 58-60 (–ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ)
- ‚úÖ Click Response: 15-25ms
- ‚úÖ 100 —É–∑–ª–æ–≤: –ø–ª–∞–≤–Ω–æ
- ‚úÖ Memory stable: –Ω–µ—Ç —É—Ç–µ—á–µ–∫
