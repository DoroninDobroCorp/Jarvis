# Decision Log

## 2025-10-03 22:13 — Инициализация Memory Bank

**Контекст:** Проект уже имеет зрелую кодовую базу с оптимизациями.

**Решение:** Создать memory-bank систему для отслеживания контекста и решений.

**Обоснование:** Согласно пользовательским правилам, memory-bank критичен для долгосрочной работы над проектом.

---

## 2025-10-03 22:13 — Реорганизация документации

**Проблема:** Файлы `.md` разбросаны по корню проекта, нарушая правила организации.

**Решение:** Создать `docs/` директорию и переместить туда:
- `FAKE-SHADOWS.md`
- `OPTIMIZATION-SUMMARY.md`
- `PERFORMANCE.md`
- `PROCHEE-TEST.md`

**Обоснование:** Чистота корня проекта, соблюдение пользовательских правил.

---

## 2025-10-03 22:13 — Переход с uuid на crypto.randomUUID()

**Проблема:** Зависимость `uuid` (13.0.0) для генерации ID.

**Решение:** Использовать нативный `crypto.randomUUID()`.

**Обоснование:**
- Нативный API — нет лишних зависимостей
- Поддержка: все современные браузеры + Node 18+
- Меньше размер бандла

**Риски:** Нужна полифилл-проверка для старых браузеров (но проект на React 19, требует современный браузер).

---

## 2025-10-03 22:13 — Добавление Vitest для unit тестов

**Проблема:** Отсутствуют unit тесты для утилит (throttle, raf-batch, recurrence).

**Решение:** Настроить Vitest (идеально интегрируется с Vite).

**Обоснование:**
- Быстрые unit тесты для критической логики
- Native ESM support
- Shared config с Vite

---

## 2025-10-03 22:13 — Pre-commit hooks (husky + lint-staged)

**Проблема:** Нет автоматической проверки перед коммитом.

**Решение:** Настроить husky + lint-staged.

**Обоснование:**
- Предотвращение коммитов с ошибками линтинга
- Автоматический запуск тестов
- Улучшение качества кода в команде

---

## 2025-10-04 13:36 — Динамические интервалы для Telegram-бота

**Проблема:** Telegram-бот использует фиксированные слоты времени (11:30, 14:30, 17:30, 20:30, 23:30) для вопросов о самочувствии.

**Решение:** Переход на динамические 3-часовые интервалы — после каждого отчета следующий вопрос планируется через 3 часа.

**Обоснование:**
- Гибкость: пользователь может отправить отчет в любое время, и отсчет начнется заново
- Более естественный ритм отслеживания состояния
- Отсутствие привязки к конкретному времени суток

**Изменения:**
1. `storeRatings()` — добавлен вызов `scheduleNextQuestion(3 * 60 * 60 * 1000)` после сохранения отчета
2. `computeNextSlotDelayMs()` — упрощена до возврата константы 3 часа
3. `/start` команда — обновлен текст приветствия
